webpackJsonp([1],{"IT/x":function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",[t("h1",[s._v("Scaling DAG Creation With Apache Airflow")]),s._v(" "),t("p",[s._v("One of the more difficult tasks within the Data Science community is not designing a model to a well-constructed business problem or developing the code-base to operate in a scalable environment, but, rather, arranging the tasks in the ETL, or in the Data Science pipeline, executing the model on a periodic basis and automating everything in-between.")]),s._v(" "),t("p",[s._v("This is where Apache Airflow comes to the rescue! With the Airflow UI to display the task in a graph form, and with the ability to programmatically define your workflow to increase traceability, it is much easier to define and configure your Data Science workflow in production.")]),s._v(" "),t("p",[s._v("One difficulty still remains, though. There are circumstances when the same modelling, monolithic, process is utilized and applied to different data sources. To increase performance, it is better to have each of these processes run concurrently, rather than add them to the same dag.")]),s._v(" "),t("p",[s._v("No problem, let us simply create a dag for each process, all with similar tasks, and schedule them to run at the same time. If we were to follow along software development principle DRY, is there a way to create multiple different dags with the same-type tasks without having to manually create them?")]),s._v(" "),t("h2",[s._v("The Initial Approach")]),s._v(" "),t("p",[s._v("Firstly, let us assume our initial dag looks like this:")]),s._v(" "),t("div",{staticClass:"card"},[t("div",{staticClass:"card-body p-3",attrs:{id:"code-block"}},[t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-python"}},[s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" datetime "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" datetime, timedelta\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" dateutil.relativedelta "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" relativedelta\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" time "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" sleep\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" airflow "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" DAG\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" airflow.operators.python_operator "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" PythonOperator\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("## the default arguments for the DAG")]),s._v("\n\ndefault_args = {\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"depends_on_past"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"start_date"')]),s._v(": datetime.now() - relativedelta(days="),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("),\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"retries"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"retry_delay"')]),s._v(": timedelta(seconds="),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("120")]),s._v("),\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"email_on_failure"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")]),s._v("\n}\n\ndag = DAG("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dummy"')]),s._v(", default_args=default_args, schedule_interval="),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("None")]),s._v(")\n\n"),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("tmp")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"""\n    python function we are to use that only sleeps for 60 seconds.\n    """')]),s._v("\n    sleep("),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("60")]),s._v(")\n\n    print("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Dag passed!"')]),s._v(")\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("None")]),s._v("\n\nt1 = PythonOperator(python_callable=tmp, task_id="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"time"')]),s._v(", dag=dag)\n\n")])])])]),s._v(" "),t("p",[s._v("The purpose of this dag is to simply sleep and then print a statement. This is a very simple dag, but let us assume this would represent our Data Science workflow. If this was the only Data Science workflow we were doing to deploy into production, we would most probably become satisfied.")]),s._v(" "),t("p",[s._v("However, what if, as asked earilier, we want to create multiple dags with the same-type tasks without having to manually create them? For example, with the example of our initial dag above, what if we wanted to configure how many seconds we want to sleep before printing a statement?")]),s._v(" "),t("p",[s._v("This is where we need to understand which parts of our process is configurable, and then allow those to become variables in our process. Lets take another stab at our initial dag:")]),s._v(" "),t("div",{staticClass:"card"},[t("div",{staticClass:"card-body p-3",attrs:{id:"code-block"}},[t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-python"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" datetime "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" datetime, timedelta\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" dateutil.relativedelta "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" relativedelta\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" time "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" sleep\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" airflow "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" DAG\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" airflow.operators.python_operator "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" PythonOperator\n\ndefault_args = {\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"depends_on_past"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"start_date"')]),s._v(": datetime.now() - relativedelta(days="),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("),\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"retries"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"retry_delay"')]),s._v(": timedelta(seconds="),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("120")]),s._v("),\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"email_on_failure"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")]),s._v("\n}\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# this function will create a dag, define the python callable and add it to the PythonOperator")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("create_dag")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("(dag_id, seconds="),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("60")]),s._v(")")]),s._v(":")]),s._v("\n    dag = DAG(dag_id, default_args=default_args, schedule_interval="),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("None")]),s._v(")\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("tmp")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("()")]),s._v(":")]),s._v("\n        sleep(seconds)\n\n        print("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Dag passed!"')]),s._v(")\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("None")]),s._v("\n\n    t1 = PythonOperator(python_callable=tmp, task_id="),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"time"')]),s._v(", dag=dag)\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" dag\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# here we create a global variable called dummy dag, which will store the DAG object here.")]),s._v("\nglobals()["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dummy_dag"')]),s._v("] = create_dag("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dummy"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("60")]),s._v(")\n")])])])]),s._v(" "),t("p",[s._v("When a variable is added to the global dictionary in a python script, it is rendered and treated as a variable that was created in the global-scope, even if it was initially created in the function-scope. Now you can create multiple dags, with similar tasks, with ease.")]),s._v(" "),t("p",[s._v("Generally, most would simply create multiple python scripts with similar DAG creation processes.")]),s._v(" "),t("p",[s._v("However, there is a better way.")]),s._v(" "),t("h2",[s._v("Configurable Task Assignments To a Specific Dag")]),s._v(" "),t("p",[s._v("Consider this example, where we initial define this in a python module called task_assigner.py")]),s._v(" "),t("div",{staticClass:"card"},[t("div",{staticClass:"card-body p-3",attrs:{id:"code-block"}},[t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-python"}},[s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" functools "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" reduce\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" airflow.operators "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" *\n\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# this will be just a small subset of operators that we will define")]),s._v("\ntask_dict = {\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"external_task"')]),s._v(": ExternalTaskSensor,\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'python_operator'")]),s._v(": PythonOperator,\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'trigger_dag'")]),s._v(": TriggerDagOperator,\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"bash"')]),s._v(": BashOperator\n}\n\n"),t("span",{pre:!0,attrs:{class:"hljs-class"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("TaskAssigner")]),s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("__init__")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("(self, parent_dag)")]),s._v(":")]),s._v("\n        self.parent_dag = parent_dag\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("define_tasks")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("(self, task_params)")]),s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"""\n    This will use the task_dict to help map the task define to the appropriate task with the correct parameters\n\n    :param tsk_name: The unique name of the task\n    :type: str\n    :param task_params: The parameters for all the task\n    :type: dict\n    """')]),s._v("\n\n        defined_tsk_dict = {}\n\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" tsk "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" task_params.keys():\n            dag_type = task_params[tsk]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"type"')]),s._v("]\n            params = task_params[tsk]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"params"')]),s._v("]\n            params["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dag"')]),s._v("] = self.parent_dag\n            params["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"task_id"')]),s._v("] = tsk\n\n            defined_tsk_dict[tsk] = task_dict[dag_type](**params)\n\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" defined_tsk_dict\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("map_task")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("(self, tsk_names, defined_task_dict)")]),s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"""\n    This will help map the sequence of the tasks to the appropriate defined task\n\n    :param tsk_names: The sequence of the tasks to run\n    :type tsk_names: str\n    :param defined_task_dict: The dictionary of defined tasks\n    :type defined_task_dict: dict\n    """')]),s._v("\n\n        res_lst = []\n\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" tsks "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" tsk_names:\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" isinstance(tsks, list):\n                res_lst.append(self.map_task(tsks, defined_task_dict))\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("elif")]),s._v(" isinstance(tsks, str):\n                res_lst.append(defined_task_dict[tsks])\n            "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(":\n                "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("raise")]),s._v(" ValueError\n\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" res_lst    \n\n    "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("(self, task_sequence, task_params)")]),s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"""\n    This will assign each task in the sequence, with the right parameters, to the parent dag\n\n    :param task_sequence: This will be a list of, or a list of list, of strings\n    :type task_sequence: List[List[str]] or List[List[List[str]]], or something in between.\n    :param task_params: The parameters for all the task\n    :type task_params: dict\n    """')]),s._v("\n\n        defined_task_dict = self.define_tasks(task_params)\n\n        "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# this is a List[List[Tasks]] or a List[List[List[Tasks]]]")]),s._v("\n        run_lst = self.map_task(task_sequence, defined_task_dict)\n\n        "),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("tmf")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("(tsks)")]),s._v(":")]),s._v("\n            reduce("),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("lambda")]),s._v(" tsk1, tsk2: tsk1 >> tsk2, tsks["),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(":], tsks["),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("])\n\n        list(map(tmp, run_lst))\n\n        "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("None")]),s._v("\n\n")])])])]),s._v(" "),t("p",[s._v("Then in another script you use the TaskAssigner, lets say in dag.py")]),s._v(" "),t("div",{staticClass:"card"},[t("div",{staticClass:"card-body p-3",attrs:{id:"code-block"}},[t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-python"}},[s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" json\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" datetime "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" datetime, timedelta\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" dateutil.relativedelta "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" relativedelta\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" time "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" sleep\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" airflow "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" DAG\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" airflow.operators.python_operator "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" PythonOperator\n\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" task_assigner "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" TaskAssigner\n\ndefault_args = {\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"depends_on_past"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"start_date"')]),s._v(": datetime.now() - relativedelta(days="),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v("),\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"retries"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"retry_delay"')]),s._v(": timedelta(seconds="),t("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("120")]),s._v("),\n    "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"email_on_failure"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")]),s._v("\n}\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# now what we do is create a dag, pass it into the TaskAssigner")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# with the dag sequence and the params for each task in the dag.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-function"}},[t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("create_dag")]),t("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("(dag_id, dag_sequence, dag_params)")]),s._v(":")]),s._v("\n    dag = DAG(dag_id, default_args=default_args, schedule_interval="),t("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("None")]),s._v(")\n\n    tsk_assign = TaskAssigner(dag)\n\n    tsk_assign.run(dag_sequence, dag_params)\n\n    "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" dag\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# we read in our configuration file with our parameters in the dag")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("with")]),s._v(" open("),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dag_configs.json"')]),s._v(") "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("as")]),s._v(" f:\n    config = json.load(f)\n"),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# we loop through each dag id in the JSON file, and then create our dag and add it as a global variable here.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" dg_id "),t("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" config.keys():\n    globals()[dg_id] = create_dag(dg_id, config[dg_id]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dag_sequence"')]),s._v("], config[dg_id]["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dag_params"')]),s._v("])\n\n")])])]),s._v(" "),t("p",[s._v("The dag_configs.json used here is:")]),s._v(" "),t("div",{staticClass:"card p-3",attrs:{id:"code-block"}},[t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":"",class:"language-json"}},[s._v("{\n  "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dummy"')]),s._v(": {\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dag_sequence"')]),s._v(": [["),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dummy"')]),s._v("]],\n    "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dag_params"')]),s._v(": {\n      "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"dummy"')]),s._v(": {\n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"type"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"bash"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"params"')]),s._v(": {"),t("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v('"bash_command"')]),s._v(": "),t("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sleep 60"')]),s._v("}\n      }\n    }\n  }\n}\n")])])])]),s._v(" "),t("h2",[s._v("Putting It All Together")]),s._v(" "),t("p",[s._v("Now, we discussed how to define multiple dags utilizing OOP, which is DRY compliant. However, this is assuming each dag is independent of each other, which is not normally the case within practice. There are cases where each dag is possibly dependent on another dag.")]),s._v(" "),t("p",[s._v("What do you think the solution is?")]),s._v(" "),t("p",[s._v("Please reach out to PyScale on twitter with your solution!")]),s._v(" "),t("p",[s._v("As always, #happycoding!")])])}]},r=t("VU/8")(null,e,!1,null,null,null);a.default=r.exports},X7wI:function(s,a,t){s.exports=t("IT/x")}});
//# sourceMappingURL=1.b1d0d1e9dea53d15fad9.js.map